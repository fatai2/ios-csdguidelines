name: Publish to Testflight

on:
  push:
    branches:
      - ios-deploy
    tags:
      - v*

jobs:
  publish-to-testflight:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v2
      - name: Upload app to App Store Connect
        run: |
          curl -Ls https://git.io/JIgx5 | grep -wo "https.*.ipa" | wget -qi -
          xcrun altool --upload-app -t ios -f csdguidelines.ipa -u "${{ secrets.EXPO_APPLE_ID }}" -p "${{ secrets.APP_SPECIFIC_PASSWORD }}"
